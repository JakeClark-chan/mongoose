{"version":3,"file":"Slider.js","sources":["../../../../src/components/other/Slider/Slider.tsx"],"sourcesContent":["import React, {\n  useState,\n  useRef,\n  TouchEvent,\n  useEffect,\n  FC,\n  ReactNode,\n  MouseEvent,\n} from 'react'\nimport Slide from './parts/Slide'\nimport './Slider.scss'\nimport { SliderProps } from './types/interfaces'\nimport { MOUSE_HANDLER_DELAY } from './constants'\nimport { getElementSizes } from './utils'\nimport { changeElementStyle, debounce } from '../../../utils'\n\nconst Slider: FC<SliderProps> = ({\n  currentPhoto,\n  setCurrentPhoto,\n  onSlideComplete = (): void => {},\n  onSlideStart = (): void => {},\n  activeIndex = null,\n  threshHold = 25,\n  transition = 0.4,\n  images,\n  images: { length: countOfAreas },\n  scaleOnDrag = false,\n  onImageTouchStart = (): void => {},\n  onImageMoveEnd = (): void => {},\n  width = 200,\n  height = 200,\n}) => {\n  const [dimensions, setDimensions] = useState({ width, height })\n  const dragging = useRef(false)\n  const startPos = useRef(0)\n  const currentTranslate = useRef(0)\n  const prevTranslate = useRef(0)\n  const currentIndex = useRef(currentPhoto)\n  const sliderRef = useRef<HTMLDivElement | null>(null)\n  const sliderRefWrapper = useRef<HTMLDivElement | null>(null)\n  const animationRef = useRef(0)\n\n  const setSliderPosition = (): void => {\n    changeElementStyle(sliderRef.current!, {\n      transform: `translateX(${currentTranslate.current}px)`,\n    })\n  }\n\n  const setPositionByIndex = (w = dimensions.width): void => {\n    currentTranslate.current = currentIndex.current * -w\n    prevTranslate.current = currentTranslate.current\n    setSliderPosition()\n  }\n\n  const transitionOn = (): void => {\n    changeElementStyle(sliderRef.current!, {\n      transition: `transform ${transition}s ease-out`,\n    })\n  }\n\n  useEffect(() => {\n    if (currentPhoto !== currentIndex.current) {\n      transitionOn()\n      currentIndex.current = currentPhoto\n      setPositionByIndex()\n    }\n  }, [activeIndex, currentPhoto])\n\n  // set width after first render\n  // set position by startIndex\n  // no animation on startIndex\n  useEffect(() => {\n    if (sliderRef.current) {\n      setDimensions(getElementSizes(sliderRef.current))\n      setPositionByIndex(getElementSizes(sliderRef.current).width)\n    }\n  }, [])\n\n  const animation = (): void => {\n    setSliderPosition()\n    if (dragging.current) requestAnimationFrame(animation)\n  }\n\n  const onMouseMove = (clientX: number): void => {\n    const {\n      left: leftEdge,\n      width,\n    } = sliderRefWrapper.current!.getBoundingClientRect()\n\n    const mouseXInImageAreaPercent = Math.trunc(\n      ((clientX - leftEdge) / width) * 100,\n    )\n\n    const newPhotoIndex = Math.floor(\n      mouseXInImageAreaPercent / (100 / countOfAreas),\n    )\n    const photoNeedToBeChaged = currentPhoto !== newPhotoIndex\n\n    if (photoNeedToBeChaged) {\n      setCurrentPhoto(newPhotoIndex)\n    }\n  }\n\n  const touchMoveHandler = (event: TouchEvent): void => {\n    if (dragging.current) {\n      const currentPosition = event.touches[0].clientX\n      currentTranslate.current =\n        prevTranslate.current + currentPosition - startPos.current\n    }\n  }\n\n  const moveEndHandler = (): void => {\n    transitionOn()\n    cancelAnimationFrame(animationRef.current)\n    dragging.current = false\n    const distance = currentTranslate.current - prevTranslate.current\n\n    onImageMoveEnd()\n    const imageSwipedToRight =\n      distance < -threshHold && currentIndex.current < countOfAreas - 1\n    if (imageSwipedToRight) currentIndex.current += 1\n\n    const imageSwipedToLeft = distance > threshHold && currentIndex.current > 0\n\n    if (imageSwipedToLeft) currentIndex.current -= 1\n\n    transitionOn()\n    setPositionByIndex()\n    changeElementStyle(sliderRef.current!, { cursor: 'grab' })\n    onSlideComplete(currentIndex.current)\n    setCurrentPhoto(currentIndex.current)\n  }\n\n  const onMouseMoveHandler = debounce<(clientX: number) => void>(\n    onMouseMove,\n    MOUSE_HANDLER_DELAY,\n  )\n\n  const preventImageDrag = (e: MouseEvent<HTMLDivElement>): void => {\n    e.preventDefault()\n    e.stopPropagation()\n  }\n\n  const touchStartHadler = (event: TouchEvent<HTMLDivElement>): void => {\n    onImageTouchStart()\n    transitionOn()\n    startPos.current = event.touches[0].clientX\n    dragging.current = true\n    animationRef.current = requestAnimationFrame(animation)\n    changeElementStyle(sliderRef.current!, { cursor: 'grabbing' })\n\n    onSlideStart(currentPhoto)\n  }\n\n  const mouseLeaveHandler = (): void => {\n    if (dragging.current) moveEndHandler()\n  }\n\n  const mouseLeaveWrapperHandler = (): void => {\n    setCurrentPhoto(0)\n  }\n\n  return (\n    <div\n      ref={sliderRefWrapper}\n      className='SliderWrapper'\n      onMouseLeave={mouseLeaveWrapperHandler}\n    >\n      <div ref={sliderRef} className='Slider'>\n        {images.map((child: ReactNode, index: number) => {\n          return (\n            <div\n              key={index}\n              className='Slide__Outer'\n              onContextMenu={preventImageDrag}\n              onMouseLeave={mouseLeaveHandler}\n              onMouseMove={(e): void => {\n                // Вынужденная мера\n                // https://stackoverflow.com/questions/26317985/react-js-onclick-event-returning-all-null-values/39708388\n                onMouseMoveHandler(e.clientX)\n              }}\n              onTouchEnd={moveEndHandler}\n              onTouchMove={touchMoveHandler}\n              onTouchStart={touchStartHadler}\n            >\n              <Slide\n                child={child}\n                height={dimensions.height}\n                scaleOnDrag={scaleOnDrag}\n                width={dimensions.width}\n              />\n            </div>\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n\nexport default Slider\n"],"names":["currentPhoto","setCurrentPhoto","onSlideComplete","onSlideStart","activeIndex","threshHold","transition","images","length","countOfAreas","scaleOnDrag","onImageTouchStart","onImageMoveEnd","width","height","dimensions","setDimensions","useState","dragging","useRef","startPos","currentTranslate","prevTranslate","currentIndex","sliderRef","sliderRefWrapper","animationRef","setSliderPosition","changeElementStyle","current","transform","setPositionByIndex","w","transitionOn","useEffect","getElementSizes","animation","requestAnimationFrame","touchMoveHandler","event","currentPosition","touches","clientX","moveEndHandler","cancelAnimationFrame","distance","cursor","onMouseMoveHandler","debounce","left","leftEdge","getBoundingClientRect","mouseXInImageAreaPercent","Math","trunc","newPhotoIndex","floor","MOUSE_HANDLER_DELAY","preventImageDrag","e","preventDefault","stopPropagation","touchStartHadler","mouseLeaveHandler","React","ref","className","onMouseLeave","map","child","index","key","onContextMenu","onMouseMove","onTouchEnd","onTouchMove","onTouchStart","Slide"],"mappings":"kTAgBgC,EAC9BA,aAAAA,EACAC,gBAAAA,EACAC,gBAAAA,EAAkB,SAClBC,aAAAA,EAAe,SACfC,YAAAA,EAAc,KACdC,WAAAA,EAAa,GACbC,WAAAA,EAAa,GACbC,OAAAA,EACAA,QAAUC,OAAQC,GAClBC,YAAAA,GAAc,EACdC,kBAAAA,EAAoB,SACpBC,eAAAA,EAAiB,SACjBC,MAAAA,EAAQ,IACRC,OAAAA,EAAS,QAET,MAAOC,EAAYC,GAAiBC,WAAS,CAAEJ,MAAAA,EAAOC,OAAAA,IAChDI,EAAWC,UAAO,GAClBC,EAAWD,SAAO,GAClBE,EAAmBF,SAAO,GAC1BG,EAAgBH,SAAO,GACvBI,EAAeJ,SAAOnB,GACtBwB,EAAYL,SAA8B,MAC1CM,EAAmBN,SAA8B,MACjDO,EAAeP,SAAO,GAEtBQ,EAAoB,KACxBC,qBAAmBJ,EAAUK,QAAU,CACrCC,UAAW,cAAcT,EAAiBQ,gBAIxCE,EAAqB,CAACC,EAAIjB,EAAWF,SACzCQ,EAAiBQ,QAAUN,EAAaM,SAAWG,EACnDV,EAAcO,QAAUR,EAAiBQ,QACzCF,KAGIM,EAAe,KACnBL,qBAAmBJ,EAAUK,QAAU,CACrCvB,WAAY,aAAaA,iBAI7B4B,YAAU,KACJlC,IAAiBuB,EAAaM,UAChCI,IACAV,EAAaM,QAAU7B,EACvB+B,MAED,CAAC3B,EAAaJ,IAKjBkC,YAAU,KACJV,EAAUK,UACZb,EAAcmB,kBAAgBX,EAAUK,UACxCE,EAAmBI,kBAAgBX,EAAUK,SAAShB,SAEvD,IAEH,MAAMuB,EAAY,KAChBT,IACIT,EAASW,SAASQ,sBAAsBD,IAuBxCE,EAAoBC,IACxB,GAAIrB,EAASW,QAAS,CACpB,MAAMW,EAAkBD,EAAME,QAAQ,GAAGC,QACzCrB,EAAiBQ,QACfP,EAAcO,QAAUW,EAAkBpB,EAASS,UAInDc,EAAiB,KACrBV,IACAW,qBAAqBlB,EAAaG,SAClCX,EAASW,SAAU,EACnB,MAAMgB,EAAWxB,EAAiBQ,QAAUP,EAAcO,QAE1DjB,IAEEiC,GAAYxC,GAAckB,EAAaM,QAAUpB,EAAe,IAC1Cc,EAAaM,SAAW,GAEtBgB,EAAWxC,GAAckB,EAAaM,QAAU,IAEnDN,EAAaM,SAAW,GAE/CI,IACAF,IACAH,qBAAmBJ,EAAUK,QAAU,CAAEiB,OAAQ,SACjD5C,EAAgBqB,EAAaM,SAC7B5B,EAAgBsB,EAAaM,UAGzBkB,EAAqBC,WAlDNN,IACnB,MACEO,KAAMC,EAAQrC,MACdA,GACEY,EAAiBI,QAASsB,wBAExBC,EAA2BC,KAAKC,OAClCZ,EAAUQ,GAAYrC,EAAS,KAG7B0C,EAAgBF,KAAKG,MACzBJ,GAA4B,IAAM3C,IAERT,IAAiBuD,GAG3CtD,EAAgBsD,IAoClBE,uBAGIC,EAAoBC,IACxBA,EAAEC,iBACFD,EAAEE,mBAGEC,EAAoBvB,IACxB5B,IACAsB,IACAb,EAASS,QAAUU,EAAME,QAAQ,GAAGC,QACpCxB,EAASW,SAAU,EACnBH,EAAaG,QAAUQ,sBAAsBD,GAC7CR,qBAAmBJ,EAAUK,QAAU,CAAEiB,OAAQ,aAEjD3C,EAAaH,IAGT+D,EAAoB,KACpB7C,EAASW,SAASc,KAOxB,OACEqB,+BACEC,IAAKxC,EACLyC,UAAU,gBACVC,aAR6B,KAC/BlE,EAAgB,KASd+D,+BAAKC,IAAKzC,EAAW0C,UAAU,UAC5B3D,EAAO6D,IAAI,CAACC,EAAkBC,IAE3BN,+BACEO,IAAKD,EACLJ,UAAU,eACVM,cAAed,EACfS,aAAcJ,EACdU,YAAcd,IAGZZ,EAAmBY,EAAEjB,UAEvBgC,WAAY/B,EACZgC,YAAarC,EACbsC,aAAcd,GAEdE,wBAACa,GACCR,MAAOA,EACPvD,OAAQC,EAAWD,OACnBJ,YAAaA,EACbG,MAAOE,EAAWF"}