import { h, shallowRef, defineComponent, onMounted, unref, vShow, watch, withDirectives, } from 'vue';
import { overlayProps, useOverlay } from '../../composables/use-overlay';
import { transitionProps, useTransition } from '../../composables/use-transition';
import { useToggle } from '../../composables/use-toggle';
import { convertToUnit } from '../../helpers';
import { clickOutside } from '../../directives';
export default defineComponent({
    name: 'v-modal',
    directives: {
        clickOutside,
    },
    props: {
        modelValue: Boolean,
        zIndex: {
            type: [Number, String],
            default: 10,
        },
        width: {
            type: [Number, String],
            default: null,
        },
        closeOnClick: {
            type: Boolean,
            default: false,
        },
        ...overlayProps(),
        ...transitionProps(),
    },
    emits: ['update:modelValue'],
    setup(props, { slots, emit }) {
        const { isActive } = useToggle(props);
        const modalRef = shallowRef(null);
        onMounted(() => {
            if (props.overlay) {
                const { createOverlay, removeOverlay } = useOverlay(props, unref(modalRef));
                unref(isActive) && createOverlay();
                watch(isActive, (state) => {
                    state && createOverlay();
                    !state && removeOverlay();
                });
            }
        });
        const genContent = () => {
            const vNode = h('div', {
                class: 'v-modal__content',
                style: {
                    width: props.width ? convertToUnit(props.width) : '',
                },
            }, slots.default?.());
            return props.closeOnClick ? withDirectives(vNode, [
                [clickOutside, () => {
                        isActive.value = false;
                        emit('update:modelValue', unref(isActive));
                    }],
            ]) : vNode;
        };
        const genModal = () => {
            const propsData = {
                class: 'v-modal',
                ref: modalRef,
                ['onUpdate:modelValue']: (val) => emit('update:modelValue', val),
            };
            return withDirectives(h('div', propsData, genContent()), [
                [vShow, unref(isActive)],
            ]);
        };
        return () => useTransition(genModal(), props.transition);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVk1vZGFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvdnVlbGFuZC9zcmMvY29tcG9uZW50cy9WTW9kYWwvVk1vZGFsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFDTCxDQUFDLEVBQ0QsVUFBVSxFQUNWLGVBQWUsRUFDZixTQUFTLEVBQ1QsS0FBSyxFQUNMLEtBQUssRUFDTCxLQUFLLEVBQ0wsY0FBYyxHQUNmLE1BQU0sS0FBSyxDQUFBO0FBR1osT0FBTyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQTtBQUN4RSxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLGtDQUFrQyxDQUFBO0FBQ2pGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQUl4RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sZUFBZSxDQUFBO0FBRzdDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUcvQyxlQUFlLGVBQWUsQ0FBQztJQUM3QixJQUFJLEVBQUUsU0FBUztJQUNmLFVBQVUsRUFBRTtRQUNWLFlBQVk7S0FDYjtJQUNELEtBQUssRUFBRTtRQUNMLFVBQVUsRUFBRSxPQUFPO1FBQ25CLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7WUFDdEIsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7WUFDdEIsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELFlBQVksRUFBRTtZQUNaLElBQUksRUFBRSxPQUFPO1lBQ2IsT0FBTyxFQUFFLEtBQUs7U0FDZjtRQUNELEdBQUcsWUFBWSxFQUFFO1FBQ2pCLEdBQUcsZUFBZSxFQUFFO0tBQ3JCO0lBRUQsS0FBSyxFQUFFLENBQUMsbUJBQW1CLENBQUM7SUFFNUIsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7UUFDMUIsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNyQyxNQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFakMsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUNiLElBQUksS0FBSyxDQUFDLE9BQU8sRUFBRTtnQkFFakIsTUFBTSxFQUFFLGFBQWEsRUFBRSxhQUFhLEVBQUUsR0FBRyxVQUFVLENBQ2pELEtBQUssRUFDTCxLQUFLLENBQUMsUUFBUSxDQUFFLENBQ2pCLENBQUE7Z0JBRUQsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLGFBQWEsRUFBRSxDQUFBO2dCQUVsQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUU7b0JBQ3RCLEtBQUssSUFBSSxhQUFhLEVBQUUsQ0FBQTtvQkFDeEIsQ0FBQyxLQUFLLElBQUksYUFBYSxFQUFFLENBQUE7Z0JBQzNCLENBQUMsQ0FDRixDQUFBO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQTtRQUVGLE1BQU0sVUFBVSxHQUFHLEdBQVUsRUFBRTtZQUM3QixNQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFO2dCQUNyQixLQUFLLEVBQUUsa0JBQWtCO2dCQUN6QixLQUFLLEVBQUU7b0JBQ0wsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7aUJBQ3JEO2FBQ0YsRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFBO1lBRXJCLE9BQU8sS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRTtnQkFDaEQsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO3dCQUNsQixRQUFRLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTt3QkFDdEIsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBO29CQUM1QyxDQUFDLENBQUM7YUFDSCxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQTtRQUNaLENBQUMsQ0FBQTtRQUVELE1BQU0sUUFBUSxHQUFHLEdBQUcsRUFBRTtZQUNwQixNQUFNLFNBQVMsR0FBRztnQkFDaEIsS0FBSyxFQUFFLFNBQVM7Z0JBQ2hCLEdBQUcsRUFBRSxRQUFRO2dCQUNiLENBQUMscUJBQXFCLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsQ0FBQzthQUNqRSxDQUFBO1lBRUQsT0FBTyxjQUFjLENBQ25CLENBQUMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQ2pDO2dCQUNFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUN6QixDQUNGLENBQUE7UUFDSCxDQUFDLENBQUE7UUFFRCxPQUFPLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsRUFBRSxLQUFLLENBQUMsVUFBVyxDQUFDLENBQUE7SUFDM0QsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFZ1ZSBBUElcbmltcG9ydCB7XG4gIGgsXG4gIHNoYWxsb3dSZWYsXG4gIGRlZmluZUNvbXBvbmVudCxcbiAgb25Nb3VudGVkLFxuICB1bnJlZixcbiAgdlNob3csXG4gIHdhdGNoLFxuICB3aXRoRGlyZWN0aXZlcyxcbn0gZnJvbSAndnVlJ1xuXG4vLyBFZmZlY3RzXG5pbXBvcnQgeyBvdmVybGF5UHJvcHMsIHVzZU92ZXJsYXkgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2Utb3ZlcmxheSdcbmltcG9ydCB7IHRyYW5zaXRpb25Qcm9wcywgdXNlVHJhbnNpdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3VzZS10cmFuc2l0aW9uJ1xuaW1wb3J0IHsgdXNlVG9nZ2xlIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLXRvZ2dsZSdcblxuLy8gVHlwZXNcbmltcG9ydCB7IFZOb2RlIH0gZnJvbSAndnVlJ1xuaW1wb3J0IHsgY29udmVydFRvVW5pdCB9IGZyb20gJy4uLy4uL2hlbHBlcnMnXG5cbi8vIERpcmVjdGl2ZXNcbmltcG9ydCB7IGNsaWNrT3V0c2lkZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMnXG5cblxuZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtbW9kYWwnLFxuICBkaXJlY3RpdmVzOiB7XG4gICAgY2xpY2tPdXRzaWRlLFxuICB9LFxuICBwcm9wczoge1xuICAgIG1vZGVsVmFsdWU6IEJvb2xlYW4sXG4gICAgekluZGV4OiB7XG4gICAgICB0eXBlOiBbTnVtYmVyLCBTdHJpbmddLFxuICAgICAgZGVmYXVsdDogMTAsXG4gICAgfSxcbiAgICB3aWR0aDoge1xuICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSxcbiAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgfSxcbiAgICBjbG9zZU9uQ2xpY2s6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiBmYWxzZSxcbiAgICB9LFxuICAgIC4uLm92ZXJsYXlQcm9wcygpLFxuICAgIC4uLnRyYW5zaXRpb25Qcm9wcygpLFxuICB9LFxuXG4gIGVtaXRzOiBbJ3VwZGF0ZTptb2RlbFZhbHVlJ10sXG5cbiAgc2V0dXAocHJvcHMsIHsgc2xvdHMsIGVtaXQgfSkge1xuICAgIGNvbnN0IHsgaXNBY3RpdmUgfSA9IHVzZVRvZ2dsZShwcm9wcylcbiAgICBjb25zdCBtb2RhbFJlZiA9IHNoYWxsb3dSZWYobnVsbClcblxuICAgIG9uTW91bnRlZCgoKSA9PiB7XG4gICAgICBpZiAocHJvcHMub3ZlcmxheSkge1xuXG4gICAgICAgIGNvbnN0IHsgY3JlYXRlT3ZlcmxheSwgcmVtb3ZlT3ZlcmxheSB9ID0gdXNlT3ZlcmxheShcbiAgICAgICAgICBwcm9wcyxcbiAgICAgICAgICB1bnJlZihtb2RhbFJlZikhLFxuICAgICAgICApXG5cbiAgICAgICAgdW5yZWYoaXNBY3RpdmUpICYmIGNyZWF0ZU92ZXJsYXkoKVxuXG4gICAgICAgIHdhdGNoKGlzQWN0aXZlLCAoc3RhdGUpID0+IHtcbiAgICAgICAgICAgIHN0YXRlICYmIGNyZWF0ZU92ZXJsYXkoKVxuICAgICAgICAgICAgIXN0YXRlICYmIHJlbW92ZU92ZXJsYXkoKVxuICAgICAgICAgIH0sXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgZ2VuQ29udGVudCA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCB2Tm9kZSA9IGgoJ2RpdicsIHtcbiAgICAgICAgY2xhc3M6ICd2LW1vZGFsX19jb250ZW50JyxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICB3aWR0aDogcHJvcHMud2lkdGggPyBjb252ZXJ0VG9Vbml0KHByb3BzLndpZHRoKSA6ICcnLFxuICAgICAgICB9LFxuICAgICAgfSwgc2xvdHMuZGVmYXVsdD8uKCkpXG5cbiAgICAgIHJldHVybiBwcm9wcy5jbG9zZU9uQ2xpY2sgPyB3aXRoRGlyZWN0aXZlcyh2Tm9kZSwgW1xuICAgICAgICBbY2xpY2tPdXRzaWRlLCAoKSA9PiB7XG4gICAgICAgICAgaXNBY3RpdmUudmFsdWUgPSBmYWxzZVxuICAgICAgICAgIGVtaXQoJ3VwZGF0ZTptb2RlbFZhbHVlJywgdW5yZWYoaXNBY3RpdmUpKVxuICAgICAgICB9XSxcbiAgICAgIF0pIDogdk5vZGVcbiAgICB9XG5cbiAgICBjb25zdCBnZW5Nb2RhbCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6ICd2LW1vZGFsJyxcbiAgICAgICAgcmVmOiBtb2RhbFJlZixcbiAgICAgICAgWydvblVwZGF0ZTptb2RlbFZhbHVlJ106ICh2YWwpID0+IGVtaXQoJ3VwZGF0ZTptb2RlbFZhbHVlJywgdmFsKSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHdpdGhEaXJlY3RpdmVzKFxuICAgICAgICBoKCdkaXYnLCBwcm9wc0RhdGEsIGdlbkNvbnRlbnQoKSksXG4gICAgICAgIFtcbiAgICAgICAgICBbdlNob3csIHVucmVmKGlzQWN0aXZlKV0sXG4gICAgICAgIF0sXG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IHVzZVRyYW5zaXRpb24oZ2VuTW9kYWwoKSwgcHJvcHMudHJhbnNpdGlvbiEpXG4gIH0sXG59KVxuIl19