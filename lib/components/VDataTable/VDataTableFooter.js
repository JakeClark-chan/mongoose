import { computed, defineComponent, h, ref, unref } from 'vue';
import { VIcon } from '../VIcon';
import { VButton } from '../VButton';
import { VMenu } from '../VMenu';
import { useColors } from '../../composables/use-colors';
import { useIcons } from '../../composables/use-icons';
export const VDataTableFooter = defineComponent({
    name: 'v-data-table-footer',
    props: {
        pages: Number,
        page: Number,
        firstOnPage: Number,
        lastOnPage: Number,
        pageCorrection: Number,
        rowsLength: Number,
        rowsOnPage: Number,
        options: Object,
    },
    emits: [
        'select-rows-count',
        'next-page',
        'prev-page',
    ],
    setup(props, { emit, slots }) {
        const defaultRowsPerPageOptions = [5, 10, 15, 20];
        const { setBackgroundCssColor, setBackgroundClassNameColor, setTextClassNameColor, setTextCssColor, } = useColors();
        const { icons } = useIcons();
        const activator = ref(null);
        const rowsCountText = computed(() => {
            return `${props.firstOnPage} - ${props.lastOnPage} of ${props.rowsLength}`;
        });
        const rowsPerPageOptions = computed(() => {
            return props.options.counts?.rowsPerPageOptions || defaultRowsPerPageOptions;
        });
        async function changeTableRowsPage(isNext) {
            const { onNext, onPrev } = props.options.pagination;
            const params = { page: props.page, count: props.rowsOnPage };
            isNext && onNext && await onNext(params);
            !isNext && onPrev && await onPrev(params);
            const event = isNext ? 'next-page' : 'prev-page';
            emit(event, isNext ? 1 : -1);
        }
        function genPaginationButton(isNext = false) {
            const btnColor = props.options?.pagination?.buttonsColor || 'primary';
            const contentColor = props.options.contentColor || 'white';
            const disableIf = props.options?.pagination?.disableIf &&
                ((isNext && props.lastOnPage >= props.rowsLength) ||
                    (!isNext && props.firstOnPage === 1));
            return h(VButton, {
                width: 42,
                color: btnColor,
                elevation: 3,
                disabled: disableIf,
                text: disableIf,
                onClick: () => changeTableRowsPage(isNext),
            }, {
                default: () => h(VIcon, {
                    icon: isNext ? icons.$arrowRight : icons.$arrowLeft,
                    color: disableIf ? 'grey lighten-1' : contentColor,
                }),
            });
        }
        function genPaginationPageDisplay() {
            const displayColor = props.options?.pagination?.displayColor || 'primary';
            return h(VButton, {
                width: 42,
                style: { margin: '0 10px' },
                color: displayColor,
                elevation: 3,
            }, { default: () => props.page });
        }
        const genRowsCountSelectList = () => {
            const color = props.options?.counts?.displayColor || 'primary';
            const contentColor = props.options.contentColor || 'white';
            return h('div', {
                class: {
                    'v-data-table__rows-count-list': true,
                    ...(color ? setBackgroundClassNameColor(color) : {}),
                    ...(contentColor ? setTextClassNameColor(contentColor) : {}),
                },
                style: {
                    ...(color ? setBackgroundCssColor(color) : {}),
                    ...(contentColor ? setTextCssColor(contentColor) : {}),
                },
            }, unref(rowsPerPageOptions).map((it) => h('div', {
                class: 'v-data-table__rows-count-item',
                onClick: () => emit('select-rows-count', it),
            }, [it])));
        };
        const genMenu = () => h(VMenu, {
            activator: activator.value,
            maxHeight: 240,
            zIndex: 12,
            openOnClick: true,
        }, {
            default: () => genRowsCountSelectList(),
        });
        const genRowsCountField = () => h('div', {
            class: 'v-data-table__rows-count-value',
            textColor: props.options.contentColor,
        }, props.rowsOnPage);
        const genRowsCountSelect = () => {
            const displayColor = props.options?.counts?.displayColor || 'primary';
            return h(VButton, {
                color: displayColor,
                ref: activator,
            }, {
                default: () => [
                    genRowsCountField(),
                    activator.value && genMenu(),
                ],
            });
        };
        const genRowsCountSelectCaption = () => {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-label': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            return h('span', propsData, props.options?.counts?.rowsPerPageText || 'Rows per page');
        };
        const genRowsCountSelectBlock = () => {
            return h('div', { class: 'v-data-table__pagination-select' }, [
                genRowsCountSelectCaption(),
                genRowsCountSelect(),
            ]);
        };
        const genPagesCountDisplay = () => {
            const color = props.options.contentColor;
            const propsData = {
                class: {
                    'v-data-table__pagination-pages': true,
                    ...(color ? setTextClassNameColor(color) : {}),
                },
                style: {
                    ...(color ? setTextCssColor(color) : {}),
                },
            };
            return h('div', propsData, (props.rowsLength && slots['pagination-text']?.()) ||
                (props.rowsLength && rowsCountText.value) ||
                '-');
        };
        const genPaginationButtonsBlock = () => {
            return h('div', { class: { 'v-data-table__pagination-route': true } }, [
                genPaginationButton(),
                genPaginationPageDisplay(),
                genPaginationButton(true),
            ]);
        };
        const genPaginationBlock = () => {
            return h('div', { class: 'v-data-table__pagination' }, [
                genRowsCountSelectBlock(),
                genPagesCountDisplay(),
                genPaginationButtonsBlock(),
            ]);
        };
        emit('select-rows-count', unref(rowsPerPageOptions)[0]);
        return () => {
            const propsData = {
                class: {
                    'v-data-table__footer': true,
                    ...(props.options.color
                        ? setBackgroundClassNameColor(props.options.color)
                        : {}),
                },
                style: {
                    ...(props.options.color
                        ? setBackgroundCssColor(props.options.color)
                        : {}),
                },
            };
            return h('div', propsData, genPaginationBlock());
        };
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkRhdGFUYWJsZUZvb3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3Z1ZWxhbmQvc3JjL2NvbXBvbmVudHMvVkRhdGFUYWJsZS9WRGF0YVRhYmxlRm9vdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQVksS0FBSyxFQUFFLE1BQU0sS0FBSyxDQUFBO0FBR3hFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDaEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUNwQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBR2hDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQTtBQUV4RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFLdEQsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQUcsZUFBZSxDQUFDO0lBQzlDLElBQUksRUFBRSxxQkFBcUI7SUFDM0IsS0FBSyxFQUFFO1FBQ0wsS0FBSyxFQUFFLE1BQU07UUFDYixJQUFJLEVBQUUsTUFBTTtRQUNaLFdBQVcsRUFBRSxNQUFNO1FBQ25CLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLGNBQWMsRUFBRSxNQUFNO1FBQ3RCLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLFVBQVUsRUFBRSxNQUFNO1FBQ2xCLE9BQU8sRUFBRSxNQUEyQztLQUM5QztJQUVSLEtBQUssRUFBRTtRQUNMLG1CQUFtQjtRQUNuQixXQUFXO1FBQ1gsV0FBVztLQUNaO0lBRUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUU7UUFDMUIsTUFBTSx5QkFBeUIsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBRWpE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RCxLQUFLLEVBQUU7b0JBQ0wsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSzt3QkFDckIsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO3dCQUM1QyxDQUFDLENBQUMsRUFBRSxDQUFDO2lCQUNSO2FBQ0YsQ0FBQTtZQUVELE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFBO1FBQ2xELENBQUMsQ0FBQTtJQUNILENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBWdWUgQVBJXG5pbXBvcnQgeyBjb21wdXRlZCwgZGVmaW5lQ29tcG9uZW50LCBoLCByZWYsIFByb3BUeXBlLCB1bnJlZiB9IGZyb20gJ3Z1ZSdcblxuLy8gQ29tcG9uZW50c1xuaW1wb3J0IHsgVkljb24gfSBmcm9tICcuLi9WSWNvbidcbmltcG9ydCB7IFZCdXR0b24gfSBmcm9tICcuLi9WQnV0dG9uJ1xuaW1wb3J0IHsgVk1lbnUgfSBmcm9tICcuLi9WTWVudSdcblxuLy8gRWZmZWN0c1xuaW1wb3J0IHsgdXNlQ29sb3JzIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdXNlLWNvbG9ycydcblxuaW1wb3J0IHsgdXNlSWNvbnMgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy91c2UtaWNvbnMnXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUgfSBmcm9tICd2dWUnXG5pbXBvcnQgeyBJRGF0YVRhYmxlRm9vdGVyT3B0aW9ucyB9IGZyb20gJy4vdHlwZXMnXG5cbmV4cG9ydCBjb25zdCBWRGF0YVRhYmxlRm9vdGVyID0gZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ3YtZGF0YS10YWJsZS1mb290ZXInLFxuICBwcm9wczoge1xuICAgIHBhZ2VzOiBOdW1iZXIsXG4gICAgcGFnZTogTnVtYmVyLFxuICAgIGZpcnN0T25QYWdlOiBOdW1iZXIsXG4gICAgbGFzdE9uUGFnZTogTnVtYmVyLFxuICAgIHBhZ2VDb3JyZWN0aW9uOiBOdW1iZXIsXG4gICAgcm93c0xlbmd0aDogTnVtYmVyLFxuICAgIHJvd3NPblBhZ2U6IE51bWJlcixcbiAgICBvcHRpb25zOiBPYmplY3QgYXMgUHJvcFR5cGU8SURhdGFUYWJsZUZvb3Rlck9wdGlvbnM+LFxuICB9IGFzIGFueSxcblxuICBlbWl0czogW1xuICAgICdzZWxlY3Qtcm93cy1jb3VudCcsXG4gICAgJ25leHQtcGFnZScsXG4gICAgJ3ByZXYtcGFnZScsXG4gIF0sXG5cbiAgc2V0dXAocHJvcHMsIHsgZW1pdCwgc2xvdHMgfSk6ICgpID0+IFZOb2RlIHtcbiAgICBjb25zdCBkZWZhdWx0Um93c1BlclBhZ2VPcHRpb25zID0gWzUsIDEwLCAxNSwgMjBdXG5cbiAgICBjb25zdCB7XG4gICAgICBzZXRCYWNrZ3JvdW5kQ3NzQ29sb3IsXG4gICAgICBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IsXG4gICAgICBzZXRUZXh0Q3NzQ29sb3IsXG4gICAgfSA9IHVzZUNvbG9ycygpXG4gICAgY29uc3QgeyBpY29ucyB9ID0gdXNlSWNvbnMoKVxuXG4gICAgY29uc3QgYWN0aXZhdG9yID0gcmVmPE1heWJlPEhUTUxFbGVtZW50Pj4obnVsbClcblxuICAgIGNvbnN0IHJvd3NDb3VudFRleHQgPSBjb21wdXRlZDxzdHJpbmc+KCgpID0+IHtcbiAgICAgIHJldHVybiBgJHsgcHJvcHMuZmlyc3RPblBhZ2UgfSAtICR7IHByb3BzLmxhc3RPblBhZ2UgfSBvZiAkeyBwcm9wcy5yb3dzTGVuZ3RoIH1gXG4gICAgfSlcblxuICAgIGNvbnN0IHJvd3NQZXJQYWdlT3B0aW9ucyA9IGNvbXB1dGVkKCgpID0+IHtcbiAgICAgIHJldHVybiBwcm9wcy5vcHRpb25zLmNvdW50cz8ucm93c1BlclBhZ2VPcHRpb25zIHx8IGRlZmF1bHRSb3dzUGVyUGFnZU9wdGlvbnNcbiAgICB9KVxuXG4gICAgYXN5bmMgZnVuY3Rpb24gY2hhbmdlVGFibGVSb3dzUGFnZShpc05leHQpIHtcbiAgICAgIGNvbnN0IHsgb25OZXh0LCBvblByZXYgfSA9IHByb3BzLm9wdGlvbnMucGFnaW5hdGlvblxuXG4gICAgICBjb25zdCBwYXJhbXMgPSB7IHBhZ2U6IHByb3BzLnBhZ2UsIGNvdW50OiBwcm9wcy5yb3dzT25QYWdlIH1cblxuICAgICAgaXNOZXh0ICYmIG9uTmV4dCAmJiBhd2FpdCBvbk5leHQocGFyYW1zKVxuICAgICAgIWlzTmV4dCAmJiBvblByZXYgJiYgYXdhaXQgb25QcmV2KHBhcmFtcylcblxuICAgICAgY29uc3QgZXZlbnQgPSBpc05leHQgPyAnbmV4dC1wYWdlJyA6ICdwcmV2LXBhZ2UnXG5cbiAgICAgIGVtaXQoZXZlbnQsIGlzTmV4dCA/IDEgOiAtMSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZW5QYWdpbmF0aW9uQnV0dG9uKGlzTmV4dCA9IGZhbHNlKTogVk5vZGUge1xuICAgICAgY29uc3QgYnRuQ29sb3IgPSBwcm9wcy5vcHRpb25zPy5wYWdpbmF0aW9uPy5idXR0b25zQ29sb3IgfHwgJ3ByaW1hcnknXG4gICAgICBjb25zdCBjb250ZW50Q29sb3IgPSBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvciB8fCAnd2hpdGUnXG5cbiAgICAgIGNvbnN0IGRpc2FibGVJZiA9IHByb3BzLm9wdGlvbnM/LnBhZ2luYXRpb24/LmRpc2FibGVJZiAmJlxuICAgICAgICAoXG4gICAgICAgICAgKGlzTmV4dCAmJiBwcm9wcy5sYXN0T25QYWdlID49IHByb3BzLnJvd3NMZW5ndGgpIHx8XG4gICAgICAgICAgKCFpc05leHQgJiYgcHJvcHMuZmlyc3RPblBhZ2UgPT09IDEpXG4gICAgICAgIClcblxuICAgICAgcmV0dXJuIGgoVkJ1dHRvbiwge1xuICAgICAgICB3aWR0aDogNDIsXG4gICAgICAgIGNvbG9yOiBidG5Db2xvcixcbiAgICAgICAgZWxldmF0aW9uOiAzLFxuICAgICAgICBkaXNhYmxlZDogZGlzYWJsZUlmLFxuICAgICAgICB0ZXh0OiBkaXNhYmxlSWYsXG4gICAgICAgIG9uQ2xpY2s6ICgpID0+IGNoYW5nZVRhYmxlUm93c1BhZ2UoaXNOZXh0KSxcbiAgICAgIH0sIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT5cbiAgICAgICAgICBoKFZJY29uLCB7XG4gICAgICAgICAgICBpY29uOiBpc05leHQgPyBpY29ucy4kYXJyb3dSaWdodCA6IGljb25zLiRhcnJvd0xlZnQsXG4gICAgICAgICAgICBjb2xvcjogZGlzYWJsZUlmID8gJ2dyZXkgbGlnaHRlbi0xJyA6IGNvbnRlbnRDb2xvcixcbiAgICAgICAgICB9KSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuUGFnaW5hdGlvblBhZ2VEaXNwbGF5KCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IGRpc3BsYXlDb2xvciA9IHByb3BzLm9wdGlvbnM/LnBhZ2luYXRpb24/LmRpc3BsYXlDb2xvciB8fCAncHJpbWFyeSdcblxuICAgICAgcmV0dXJuIGgoVkJ1dHRvbiwge1xuICAgICAgICB3aWR0aDogNDIsXG4gICAgICAgIHN0eWxlOiB7IG1hcmdpbjogJzAgMTBweCcgfSxcbiAgICAgICAgY29sb3I6IGRpc3BsYXlDb2xvcixcbiAgICAgICAgZWxldmF0aW9uOiAzLFxuICAgICAgfSwgeyBkZWZhdWx0OiAoKSA9PiBwcm9wcy5wYWdlIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUm93c0NvdW50U2VsZWN0TGlzdCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbG9yID0gcHJvcHMub3B0aW9ucz8uY291bnRzPy5kaXNwbGF5Q29sb3IgfHwgJ3ByaW1hcnknXG4gICAgICBjb25zdCBjb250ZW50Q29sb3IgPSBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvciB8fCAnd2hpdGUnXG5cbiAgICAgIHJldHVybiBoKCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAgICd2LWRhdGEtdGFibGVfX3Jvd3MtY291bnQtbGlzdCc6IHRydWUsXG4gICAgICAgICAgICAuLi4oY29sb3IgPyBzZXRCYWNrZ3JvdW5kQ2xhc3NOYW1lQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICAgICAgLi4uKGNvbnRlbnRDb2xvciA/IHNldFRleHRDbGFzc05hbWVDb2xvcihjb250ZW50Q29sb3IpIDoge30pLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgIC4uLihjb2xvciA/IHNldEJhY2tncm91bmRDc3NDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgICAgICAuLi4oY29udGVudENvbG9yID8gc2V0VGV4dENzc0NvbG9yKGNvbnRlbnRDb2xvcikgOiB7fSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSwgdW5yZWYocm93c1BlclBhZ2VPcHRpb25zKS5tYXAoKGl0KSA9PiBoKCdkaXYnLCB7XG4gICAgICAgICAgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3Jvd3MtY291bnQtaXRlbScsXG4gICAgICAgICAgb25DbGljazogKCkgPT4gZW1pdCgnc2VsZWN0LXJvd3MtY291bnQnLCBpdCksXG4gICAgICAgIH0sIFtpdF0pKSxcbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBnZW5NZW51ID0gKCkgPT4gaChWTWVudSwge1xuICAgICAgYWN0aXZhdG9yOiBhY3RpdmF0b3IudmFsdWUhLFxuICAgICAgbWF4SGVpZ2h0OiAyNDAsXG4gICAgICB6SW5kZXg6IDEyLFxuICAgICAgb3Blbk9uQ2xpY2s6IHRydWUsXG4gICAgfSwge1xuICAgICAgZGVmYXVsdDogKCkgPT4gZ2VuUm93c0NvdW50U2VsZWN0TGlzdCgpLFxuICAgIH0pXG5cblxuICAgIGNvbnN0IGdlblJvd3NDb3VudEZpZWxkID0gKCkgPT4gaCgnZGl2Jywge1xuICAgICAgY2xhc3M6ICd2LWRhdGEtdGFibGVfX3Jvd3MtY291bnQtdmFsdWUnLFxuICAgICAgdGV4dENvbG9yOiBwcm9wcy5vcHRpb25zLmNvbnRlbnRDb2xvcixcbiAgICB9LCBwcm9wcy5yb3dzT25QYWdlKVxuXG5cbiAgICBjb25zdCBnZW5Sb3dzQ291bnRTZWxlY3QgPSAoKSA9PiB7XG4gICAgICBjb25zdCBkaXNwbGF5Q29sb3IgPSBwcm9wcy5vcHRpb25zPy5jb3VudHM/LmRpc3BsYXlDb2xvciB8fCAncHJpbWFyeSdcblxuICAgICAgcmV0dXJuIGgoVkJ1dHRvbiwge1xuICAgICAgICBjb2xvcjogZGlzcGxheUNvbG9yLFxuICAgICAgICByZWY6IGFjdGl2YXRvcixcbiAgICAgIH0sIHtcbiAgICAgICAgZGVmYXVsdDogKCkgPT4gW1xuICAgICAgICAgIGdlblJvd3NDb3VudEZpZWxkKCksXG4gICAgICAgICAgYWN0aXZhdG9yLnZhbHVlICYmIGdlbk1lbnUoKSxcbiAgICAgICAgXSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUm93c0NvdW50U2VsZWN0Q2FwdGlvbiA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBjb2xvciA9IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLWxhYmVsJzogdHJ1ZSxcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIC4uLihjb2xvciA/IHNldFRleHRDc3NDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFxuICAgICAgICAnc3BhbicsXG4gICAgICAgIHByb3BzRGF0YSxcbiAgICAgICAgcHJvcHMub3B0aW9ucz8uY291bnRzPy5yb3dzUGVyUGFnZVRleHQgfHwgJ1Jvd3MgcGVyIHBhZ2UnLFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdlblJvd3NDb3VudFNlbGVjdEJsb2NrID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLXNlbGVjdCcgfSwgW1xuICAgICAgICBnZW5Sb3dzQ291bnRTZWxlY3RDYXB0aW9uKCksXG4gICAgICAgIGdlblJvd3NDb3VudFNlbGVjdCgpLFxuICAgICAgXSlcbiAgICB9XG5cbiAgICBjb25zdCBnZW5QYWdlc0NvdW50RGlzcGxheSA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICBjb25zdCBjb2xvciA9IHByb3BzLm9wdGlvbnMuY29udGVudENvbG9yXG5cbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLXBhZ2VzJzogdHJ1ZSxcbiAgICAgICAgICAuLi4oY29sb3IgPyBzZXRUZXh0Q2xhc3NOYW1lQ29sb3IoY29sb3IpIDoge30pLFxuICAgICAgICB9LFxuICAgICAgICBzdHlsZToge1xuICAgICAgICAgIC4uLihjb2xvciA/IHNldFRleHRDc3NDb2xvcihjb2xvcikgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKFxuICAgICAgICAnZGl2JyxcbiAgICAgICAgcHJvcHNEYXRhLFxuICAgICAgICAocHJvcHMucm93c0xlbmd0aCAmJiBzbG90c1sncGFnaW5hdGlvbi10ZXh0J10/LigpKSB8fFxuICAgICAgICAocHJvcHMucm93c0xlbmd0aCAmJiByb3dzQ291bnRUZXh0LnZhbHVlKSB8fFxuICAgICAgICAnLScsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUGFnaW5hdGlvbkJ1dHRvbnNCbG9jayA9ICgpOiBWTm9kZSA9PiB7XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogeyAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uLXJvdXRlJzogdHJ1ZSB9IH0sIFtcbiAgICAgICAgZ2VuUGFnaW5hdGlvbkJ1dHRvbigpLFxuICAgICAgICBnZW5QYWdpbmF0aW9uUGFnZURpc3BsYXkoKSxcbiAgICAgICAgZ2VuUGFnaW5hdGlvbkJ1dHRvbih0cnVlKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgY29uc3QgZ2VuUGFnaW5hdGlvbkJsb2NrID0gKCk6IFZOb2RlID0+IHtcbiAgICAgIHJldHVybiBoKCdkaXYnLCB7IGNsYXNzOiAndi1kYXRhLXRhYmxlX19wYWdpbmF0aW9uJyB9LCBbXG4gICAgICAgIGdlblJvd3NDb3VudFNlbGVjdEJsb2NrKCksXG4gICAgICAgIGdlblBhZ2VzQ291bnREaXNwbGF5KCksXG4gICAgICAgIGdlblBhZ2luYXRpb25CdXR0b25zQmxvY2soKSxcbiAgICAgIF0pXG4gICAgfVxuXG4gICAgZW1pdCgnc2VsZWN0LXJvd3MtY291bnQnLCB1bnJlZihyb3dzUGVyUGFnZU9wdGlvbnMpWzBdKVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IHByb3BzRGF0YSA9IHtcbiAgICAgICAgY2xhc3M6IHtcbiAgICAgICAgICAndi1kYXRhLXRhYmxlX19mb290ZXInOiB0cnVlLFxuICAgICAgICAgIC4uLihwcm9wcy5vcHRpb25zLmNvbG9yXG4gICAgICAgICAgICA/IHNldEJhY2tncm91bmRDbGFzc05hbWVDb2xvcihwcm9wcy5vcHRpb25zLmNvbG9yKVxuICAgICAgICAgICAgOiB7fSksXG4gICAgICAgIH0sXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgLi4uKHByb3BzLm9wdGlvbnMuY29sb3JcbiAgICAgICAgICAgID8gc2V0QmFja2dyb3VuZENzc0NvbG9yKHByb3BzLm9wdGlvbnMuY29sb3IpXG4gICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgfSxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGgoJ2RpdicsIHByb3BzRGF0YSwgZ2VuUGFnaW5hdGlvbkJsb2NrKCkpXG4gICAgfVxuICB9LFxufSlcbiJdfQ==